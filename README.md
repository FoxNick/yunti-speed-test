# yunti-speed-test
批量测试云梯VPN各服务器的速度，以方便在不同的网络环境下选择合适的服务器。

* Gradle 构建项目
* HttpClient、jsoup 抓取、解析网页

命令`gradle pack`能自动打包 jar 和 init.properties 到 release 文件夹
```
task pack(type: Copy) {
    from 'build/libs'
    into 'release'
}

task copyConfig(type: Copy) {
    from 'init.properties'
    into 'release'
}

pack.dependsOn 'build', 'copyConfig'
```

## init.properties配置文件说明
```
# 云梯服务器地址，注意地址最后没有/
server_url=https://www.ttincloud.com

# 登录云梯的账号密码，访问服务器列表需要先登录
username=test
password=password

# 测速使用的命令，暂时只支持ping
method=ping
# 仅在method=ping时有效，表示发送的ping包个数
ping_count=12

#
# 附加信息输出控制
#
# 查看ping测速结果中最快的10条线路
filter_record=10
# 若这10条线路中某条线路的备注包含以下筛选词，则打印这条线路的信息
# init.properties写入中文会乱码，添加筛选词时请添加UTF8编码
# \u7EF4\u62A4是汉字“维护”的UTF8编码，筛选词间以英文逗号隔开
filter_words=\u7EF4\u62A4,

#
# 匹配ping统计信息的正则表达式
# 根据自己的平台选择相应的组，删掉行首的#
#
# 若要扩展，可直接在文件内添加相应的正则表达式
# 
# Mac用户
#pattern_package=\\s*(\\d+)[\\s\\S]*transmitted,\\s*(\\d+)[\\s\\S]*received,\\s*(\\d+\\.\\d+|\\d+)%[\\s\\S]*
#pattern_roundtrip=[\\s\\S]*round-trip[\\s\\S]*=[\\s]*(\\d+\\.\\d+|\\d+)/(\\d+\\.\\d+|\\d+)/(\\d+\\.\\d+|\\d+)/([\\s\\S]*)

# Windows中文用户
#pattern_package=[\\s\\S]*[\\u4E00-\\u9FA5]+\\s*=\\s*(\\d+)\\uFF0C\\s*[\\u4E00-\\u9FA5]+\\s*=\\s*(\\d+)\\uFF0C\\s*[\\u4E00-\\u9FA5]+[\\s\\S]*\\((\\d+\\.\\d+|\\d+)%[\\s\\S]*
#pattern_roundtrip=[\\s\\S]*[\\u4E00-\\u9FA5]+\\s*=\\s*(\\d+\\.\\d+|\\d+)ms[\\s\\S]*[\\u4E00-\\u9FA5]+\\s*=\\s*(\\d+\\.\\d+|\\d+)ms[\\s\\S]*[\\u4E00-\\u9FA5]+\\s*=\\s*(\\d+\\.\\d+|\\d+)ms[\\s\\S]*

# Windows英文用户
#pattern_package=[\\s\\S]*Sent\\s*=\\s*(\\d+),\\s*Received\\s*=\\s*(\\d+),\\s*Lost[\\s\\S]*\\((\\d+\\.\\d+|\\d+)%[\\s\\S]*
#pattern_roundtrip=[\\s\\S]*Minimum\\s*=\\s*(\\d+\\.\\d+|\\d+)ms[\\s\\S]*Maximum\\s*=\\s*(\\d+\\.\\d+|\\d+)[\\s\\S]*Average\\s*=\\s*(\\d+\\.\\d+|\\d+)ms[\\s\\S]*
```

## 使用说明
0. 本地命令行有 jdk 或 jre 环境
1. 命令行下 cd 到`release`文件夹
2. 修改`init.properties` 中的配置
3. 命令行中运行 `java -jar yunti-speed-test.jar` 测速
4. 输出形如
```
aaron67-mbp:release aaron67$ java -jar yunti-speed-test.jar
读取配置文件
登录云梯网站
登录成功
抓取服务器列表成功
服务器线路共28条，状态为正常的线路有26条
开始PING测速
启动26个线程测速
测速结束
-------------------------------------------------------------------------
    Server  Protocol       PKG     Miss%       MIN       MAX       AVG
-------------------------------------------------------------------------
      英国1号      L2TP        12       0.0   375.955     454.2   385.773
      英国1号      PPTP        12       0.0   376.503   389.228   382.078
      美国3号      L2TP        12       0.0   249.848   325.272    263.82
      美国2号      PPTP        12       0.0   238.627   317.369    258.56
      美国3号      PPTP        12       0.0   249.981    325.29    257.94
      美国2号      L2TP        12       0.0   240.487   317.733   248.017
      美国5号      L2TP        12       0.0    235.07   315.747   242.919
      美国4号      PPTP        12       0.0   229.942   307.575   238.333
      美国4号      L2TP        12       0.0   222.289   296.469   236.544
      美国1号      L2TP        12       0.0    228.06   301.797   236.082
      美国5号      PPTP        12       0.0    229.39   235.085   231.772
      美国1号      PPTP        12       0.0   228.058   232.314   229.546
      日本3号      L2TP        12       0.0   147.706   234.419   178.165
     新加坡2号      PPTP        12       0.0   154.303   228.573   165.951
     新加坡1号      L2TP        12       0.0   153.265   228.672   165.946
      日本3号      PPTP        12       0.0   146.572   224.799   163.338
      日本2号      L2TP        12       0.0   136.473   219.897   158.779
     新加坡1号      PPTP        12       0.0   141.189   214.935   157.962
     新加坡2号      L2TP        12       0.0   147.445   168.994   155.568
      日本2号      PPTP        12       0.0   128.332     149.1   134.836
      香港1号      L2TP        12       0.0   118.801   191.442   126.226
      香港1号      PPTP        12       0.0   117.586   191.511   125.553
      香港2号      L2TP        12       0.0   115.763   190.381   124.019
      香港2号      PPTP        12       0.0   121.522    132.37   123.846
      台湾1号      L2TP        12       0.0    89.553    99.119    91.507
      台湾1号      PPTP        12       0.0    88.249    92.341    90.232
-------------------------------------------------------------------------
      香港2号      PPTP	电信良好。联通优秀。（2015年10月29日 00:00 - 02:00，机房维护）
      香港2号      L2TP	电信良好。联通优秀。（2015年10月29日 00:00 - 02:00，机房维护）
-------------------------------------------------------------------------
aaron67-mbp:release aaron67$
```

## 贡献者列表
[itcrazyjin](https://github.com/itcrazyjin)
